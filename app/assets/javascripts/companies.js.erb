$(document).ready(function(){

  var data;

  function graphChart(data){
    var volume = [];

    Highcharts.setOptions({
        global: {
            useUTC : false
        }
    });

    groupingUnits = [[
        'week',                         // unit name
        [1]                             // allowed multiples
    ], [
        'month',
        [1, 2, 3, 4, 6]
    ]];

    data.forEach(function(element){
      volume.push([element[0],element[5]]);
    });

    // Create the chart
    $('#companyPriceChart').highcharts('StockChart', {
      chart: {
        backgroundColor: 'transparent'
      },

      rangeSelector: {
        inputEnabled: false,
        selected: 0
      },

      xAxis: {
        type: {
          millisecond: '%H:%M:%S.%L',
          second: '%H:%M:%S',
          minute: '%H:%M',
          hour: '%H:%M',
          day: '%e. %b',
          week: '%e. %b',
          month: '%b \'%y',
          year: '%Y'
        }
      },

      yAxis: [{
        labels: {
            align: 'right',
            x: -3
        },
        title: {
            text: 'OHLC'
        },
        height: '80%',
        lineWidth: 2
      }, {
        labels: {
            align: 'right',
            x: -3
        },
        title: {
            text: 'Volume'
        },
        top: '65%',
        height: '35%',
        offset: 0,
        lineWidth: 2
      }],

      title: {
        text: 'Daily Quotes'
      },

      exporting: {
        enabled: false
      },

      series: [{
        name: 'Daily Quote',
        type: 'candlestick',
        data: data,
        dataGrouping: {
          units: groupingUnits
        }
      }, {
        type: 'column',
        name: 'Volume',
        data: volume,
        yAxis: 1,
        dataGrouping: {
            units: groupingUnits
        }
      }]
    });
  }

  if (gon.company){
    var company_id = gon.company.id;

    $.getJSON('/daily_quotes/'+company_id+'.json', function(data){
      graphChart(data);
    })
  }

});